<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SCAN DIAGNOSTIC</title>
<style>
  body{font-family:Arial;background:#071428;color:#e6eef6;margin:0;padding:20px}
  .card{background:#0d1528;padding:14px;border-radius:10px;max-width:900px;margin:auto}
  .log{white-space:pre-wrap;font-size:12px;background:#0003;padding:10px;border-radius:8px;height:300px;overflow:auto}
  button{background:#06b6d4;color:#012;border:0;padding:10px 14px;border-radius:8px;margin-top:12px}
</style>
</head>
<body>
<div class="card">
  <h2>SCAN DIAGNOSTIC</h2>
  <p>Semua tes loader CDN akan muncul di bawah.</p>

  <div><strong>Loader Status:</strong> <span id="loaderStatus">Running tests…</span></div>
  <div><strong>TF.js Detected:</strong> <span id="tfStatus">-</span></div>
  <div><strong>FaceLandmarks Detected:</strong> <span id="fldStatus">-</span></div>

  <h3>Loader Diagnostic Log (copy/screenshot kirim ke saya)</h3>
  <div class="log" id="log"></div>

  <button onclick="location.reload()">Reload Test</button>
</div>

<script>
const logEl = document.getElementById("log");
function log(msg){
  console.log(msg);
  logEl.textContent += msg + "\n";
}

const TF = "https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js";
const ESM = "https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@1.0.3/dist/face-landmarks-detection.esm.js";
const UMD = "https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@1.0.3/dist/face-landmarks-detection.min.js";

document.getElementById("loaderStatus").textContent = "Running…";

(async () => {
  log("=== TEST 1: FETCH HEAD ===");
  async function testHead(url,name){
    try{
      const r = await fetch(url,{method:"HEAD"});
      log(name + " → status " + r.status);
      return r.status;
    }catch(e){
      log(name + " → FETCH FAILED ("+e.message+")");
      return 0;
    }
  }

  await testHead(TF,"TFJS");
  await testHead(ESM,"ESM");
  await testHead(UMD,"UMD");

  log("\n=== TEST 2: TRY LOAD TF SCRIPT ===");
  try{
    await new Promise((res,rej)=>{
      const s=document.createElement("script");
      s.src=TF; s.onload=res; s.onerror=rej;
      document.head.appendChild(s);
    });
    log("TFJS Script Loaded OK");
  }catch(e){
    log("TFJS Script FAILED: "+e.message);
  }
  document.getElementById("tfStatus").textContent = !!window.tf;

  log("\n=== TEST 3: TRY LOAD UMD (SCRIPT TAG) ===");
  try{
    await new Promise((res,rej)=>{
      const s=document.createElement("script");
      s.src=UMD; s.onload=res; s.onerror=rej;
      document.head.appendChild(s);
    });
    log("UMD Script Loaded OK");
  }catch(e){
    log("UMD Script FAILED: "+e.message);
  }
  document.getElementById("fldStatus").textContent = !!window.faceLandmarksDetection;

  log("\n=== TEST 4: TRY IMPORT(ESM) ===");
  try{
    const mod = await import(ESM);
    log("ESM IMPORT OK (keys: "+Object.keys(mod).slice(0,6)+")");
  }catch(e){
    log("ESM IMPORT FAILED: "+e.message);
  }

  log("\n=== TEST 5: TRY FETCH+EVAL (fallback) ===");
  try{
    const txt = await (await fetch(UMD)).text();
    eval(txt);
    log("FETCH+EVAL OK");
  }catch(e){
    log("FETCH+EVAL FAILED: "+e.message);
  }

  document.getElementById("loaderStatus").textContent = "DONE";
})();
</script>

</body>
</html>
